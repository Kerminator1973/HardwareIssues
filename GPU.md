# Как устроена и что делает видео-карта

Рекомендуется к ознакомлению лекиця "Как работают видеокарты | Разбираем GPU по транзисторам" на канале "Мой компьютер" (RuTube). Оригинальное видео было размещено на канале **Branch Education**.

В видер рассматривается микросхема GA 102 от Nvidia, которая лежит в основе видеокарт 3000-ой серии.

В чипе используется 7 графических процессорных класетров (GPC), каждый кластер содержит 12 потоковых процессоров (Streaming Multiprocessor, SM-блоки), внутри каждого SM-блока есть 4 Warp-ядра и одно RT-ядро. Внутри каждого Warp-ядра неходятся 32 CUDA-ядра (Shading Core) и одно Тензорное ядро.

Всего на процессоре находится 10752 CUDA Cores, 336 Tensor Cores и 84 Ray Tracing Cores. Каждый тип ядер выполняет свою функцию:

- CUDA: простый вычисления, чаше всего выполняет операцию `A * B + C` за один такт
- Tensor Core: выполняет операции перемножения матриц. Чаще всего используется для геометрических преобразований и ИИ
- Ray Tracing Core: выполняет операции трассировки лучей

RT-ядра самые большие по транзисторному бюджету и самые малочисленные.

Карты Nvidia 3080, 3090, 3080ti и 3090ti используют один и тот же чип, но у них разные частоты памяти и количество отбракованных SM-блоков. Дефект отбраковывает один SM-блок.

- 3090ti - работают все 10752 CUDA-ядра
- 3090 - активно 10496 CUDA-ядер
- 3080ti - активно 10240 CUDA-ядер
- 3080 - активно 8704 CUDA-ядер (16 деактивированных SM-блоков)

Одно CUDA-ядро - это около 400 тыс. транзисторов, из которых около 50 тыс. выполняют одну операцию: `A * D + C`, которая называется "умножение со сложением с однократным округлением" (32-биные числа). Другие транзисторы выполняют побитовый сдвиг, побитовое маскирование, работу с отрицательными числами, а также управлению очередью операций. Можно сказать, что CUDA-ядро это простой калькулятор.

Можно посчитать, что GA 102 выполняет: 2 операции/такт * 10496 ядер * 1.7 Ghz = 35.6 миллиардов вычисления/секунду.

Операции деления, тригонометрия, извлечения корня осуществляются другими функциональными блоками, которых всего 4 штуки в каждом SM-блоке.

В чипе GA 102 есть Cache-память (6 МБ), PCIe и управляющий модуль.

На видеокарте размещается своя собственная память. У GA 102 ширина шины памяти - 384 бита, тогда как у центрального процессора - 64 бита.

В памяти Micron GDDR6X и GDDR7 используется несколько уровней напряжение при передачи информации, что позволяет передавать данные не по биту, а с собственной схемой кодирования (PAM3), что позволяет повысить реальную скорость передачи данных. Этот способ кодирования позволяет передавать 276 бит, используя 176 троичных цифр. В GDD6X использовалась схема PAM4, но было принято отказаться от неё, чтобы снизить сложность кодирования и улучшить соотношение сигнал/шум, а также повышает энергоэффективность. В будущих версиях GDDR-памяти предполагается использовать PAM3.

HBM = High Bandwidth Memory, память с высокой пропускной способностью. Это многослойная ОЗУ. Это позволяет устанавливать на карту 192 ГБ ОЗУ. Такой объём необходим для систем ИИ.

Говоря о параллелизме при выполнении вычислений, следует заметить, что видеокарты используют подход SIMD (Single Instruction Multiple Data).

Для примера, ковбойская шляпа в Read Dead Redemption состоит из 28 000 треугольников, построенных путём соединения между собой 13 440 вершин (vertices). Каждый объект (в частности - шляпа) использует локальное пространство, в котором каждая вершина (точка) имеет координаты X, Y, Z относительно центра этого объекта. Когда нам необходимо выполнить рендеринг сцены, необходимо пересчитывать координаты каждой вершины из локального пространства в глобальное пространство. Именно эту задачу и решают все CUDA-ядра. Для информации, типовая сцена имеет около 8,300,000 обрабатываемых вершин.

В GA 102 одна последовательность инструкций подаётся на один Warp.

В более современных архитектурах используется на SIMD, а SIMT = Single Instruction Multiple Threads. Во всех потоках используются одни и те же инструкции, но разные потоки не синхронизуются между собой и могут выполняться со своей собственной скоростью. У каждого SM-модуля есть свой собственный cache - рьъёмом 128 КБ.

Для информации, видео-карта считает около 95 миллионов хэшей SHA-256 в секунду. Однако ASIC-и считает окло 100 миллиардов хэшей в секунду.
