# Идеи о будущем Upgrade компьютера

В этом документе описываются некоторые идеи потенциального Upgrade для компьютера, а также некоторое количество слухов и домыслов, нуждающихся в проверке, но имеющиех потенциальное влияние на выбор компонентов для Upgrade.

## Intel vs AMD

В соответствии с материалами игровой прессы (в частности с английским изданием "Custom PC"), Intel и AMD выбрали разные стратегии развития своих процессоров (в статье рассмативались Intel Core 12-го поколения и AMD Ryzen 7xxx). Так, Intel фокусируется на достижении больших тактовых частот ядер, как в стандартном, так и в Boost-режимах, а AMD наращивает размер cache-памяти, в частности cache-память третьего уровня (L3), в том числе используя новые подходы в компановке чипа.

Как результат, процессоры Intel, в целом обеспечивают большую производительность на ядро, при выполнении высокоинтенсивных вычислительных операций, а процессоры AMD лучше справляются с видами нагрузки, свойственных играм, которые оказываются очень чувствительными к размеру cache-памяти процессора.

Поскольку ячейки cache-памяти сложнее и выделяют больше тепла, то процессоры AMD, обычно, гораздо более горячие, чем процессоры Intel того же поколения.

## Количество ножек процессора

Причина, по которой растёт количество контактов процессора, в первую очередь связано с количеством ядер процессора. По этой причине, маловероятно, что драматически увеличится количество производительных ядер процессора. Ещё одна причина ограниченного количества производительных ядер - сложность в отводе тепла с поверхности процессора. С высокой вероятностью, рост производительности процессоров не будет столь впечатляющим, как даже в предыдущие, не очень впечатляющие годы.

Вполне вероятно, что **big.LITTLE** будет доминировать в ближайшие годы.

## Применение памяти DDR5

Спецификации DDR5 восхитительны:

- низкое энергопотребление
- высокая тактовая частота
- широкая полоса передачи данных (с удвоением передаваемого объёма)
- в четыре раза больший объём ОЗУ, который может быть размещён на "плашке". На одной плашке DDR4 может быть 16Гб, или 32Гб (двухсторонние модули), что в совокупности даёт 128Гб ОЗУ

Однако, латентность DDR5 высокая и это минимизирует многие преимущества DDR5 по сравнению с DDR4. В синтетических тестах, DDR5 "рвёт" DDR4, но в реальных игровых замерах, разница между DDR4 и DDR5 минимальна. До тех пор, пока ценовая разница памяти является кратной, имеет смысл рассматривать качественную, брендовую память типа DDR4.

## Почему имеет смысл покупать дорогие материнские платы

Кроме поддержки современных стандартов PCIe, большего количества линии, более быстрых контроллеров USB, лучшего охлаждения, большего количество слотов памяти, дорогие материнские содержат лучшие по качеству **VRM** и усилители **MOSFET**.

VRM - импульсный преобразователь, который понижает 12 вольт, идущие от блока питания, до необходимого процессору уровня. Именно от VRM зависит подаваемое на ядра напряжение.

Дешевые VRM быстро перегреваются, что в лучшем случае приводит к тротелингу, т.е. к снижению напряжению передаваемому на ядра, до понижения температуры. На практике, это означает, что если в дешевую материнскую плату установить дорогой процессор, то он не сможет полноценно работать на писковой нагрузке. В худших случаях, производительность процессора будет в 2-3 раза ниже от штатных.

## Количество слоёв текстолита

В современных (2023 г) материнских платах чаще всего используются 6, или 8 слотов текстолита. Ориентировочно, стоимость плат с разным количеством слоёв различается в два раза. Чем больше слоёв, тем проще, в частности, изолировать линии памяти друг от друга и тем лучше работает разгон памяти. Это особенно важно для памяти DD5. Эвристическое правило: _если нужно использовать память DD5, выбирайте материнскую плату с 8 слоями текстолита_. Количество слоёв часто выводится на краю материнской плате в виде одиночной цифры.

## Развитие микропроцессоров

В 2024 году основные тренды повышения производительности процессоров:

- Увеличение размера кэша - имеет ограниченный потенциал из-за транзисторного бюджета и уменьшении эффективности поиска при увеличении размера
- Hyper-Threading - добавляется дополнительный набор регистров; два виртуальных ядра нагружают один конвейер. Основная решаемая задача - простой конвейра в случае, если происходит "промах мимо кэша". Решение - пока одно виртуальное ядро простаивает, другое нагружает конвейер своими задачами. Гипотетически, по мере улучшения предсказаний и сокрашение промахов кэша, эффективность HT должна уменьшаться. Тем не менее, можно говорить о том, что в некотором общем случае, HT даёт 10-15% производительности. Однако, в случае сложных схем с P-ядрами, E-ядрами и HT, планировщик может ошибаться (выбирает не оптимальный тип ядра для решения конкретной задачи) и это может ухудшать общую производительность системы. Возможно, что по этой причине, или по причине возникновения уязвимостей (теория заговора), от использования HT постепенно стал отказываться Intel
- Использование P-ядер и E-ядер. Условно, транзисторный бюджет 4 E-ядер равен одному P-ядру. Даже не смотря на более низкую частоту E-ядер и меньших cache, этих ядер много и они дают 30-40% прибавку к общей производительности. Если не ошибается планировщик
- Добавление специализированных функций, в частности - NPU-модулей. В новых поколениях процессоров Intel начал разменивать HT на NPU. Сложно сказать, насколько это действительно размен одного на другое, т.к. по косвенной информации в публичном поле, HT требует минимум транзисторного бюджета и "режут" его либо из-за сложности и глюков планировщика, или из-за уязвимостей
- Увеличение количества исполнительных модулей (_execution engines_). Например, у процессоров Zen 5 количество ALU на одно ядро увеличилось с 4 до 6. Потенциал роста не линейный, т.к. эффективно распараллеливать операции далеко не всегда возможно. Подход эффективен для некоторого подножества алгоритмов
- Один из способов повышения производительности процессорных ядер является разбиение сложных команд на простые. Смысл состоит в том, что если две последовательные команды нельзя выполнять одновременно, т.к. результат одной может влиять на другую, то если разделить каждую команду на простые, то у планировщика появляется гораздо больше возможностей для параллелизма, т.е. там где "большие" команды нельзя параллелить, то часть маленьких команда вполне могут выполняться параллельно, загружая свободные исполнительные модули. Однако и здесь есть инженерный компромис: "большие команды" разделяются на малкие, которые ставятся в конвейер. Чем длиннее конвейер, тем проще планировать параллелизм, но если конвейер приходится сбрасывать, то потери из-за длинного конвейера могут быть существенно больше, чем из-за короткого. Традиционно, длина конвейера x86/x64 процессорных ядер значительно превосходит длину конвейрных ядер мощных ARM

Похоже на то, что:

- HT постепенно будет исчезать
- NPU будет добавляться
- Количество P-ядер не будет рости
- Количество E-ядер, вероятно, будет рости
- Cache сильно увеличиваться не будет
- Частоты сильно увеличиваться не будут

Update июнь 2024: на выставке Computex, [специалисты Intel заявили](https://www.ixbt.com/news/2024/06/05/intel-hyper-threading-20-lunar-lake.html), что Hyper-Threading не даётся бесплатно: увеличивается вычислительный конвейер и внедряются специальные механизмы безопасности. Отключение Hyper-Threading улучшает:

- улучшению энергоэффективности
- позволяет повысить частоты функционирования процессора
- уменьшается площадь чипа

Об архитектуре E-Core Skymont: разница в длине инструкций (инструкции разной длина в x64 и инструкции одинаковой длины в ARM) уже не имеет никакого значения, т.к. эти различия, фактически, перестали играть какое-либо значение из-за изменения архитектуры модуля prefetch в Skymont.

Из интервью Максима Горшенина с Константином Трушкиным "Самые неудобные вопросы к разработчикам Эльбруса!" (сентябрь 2024):

- Prefetcher хорош тем, что его не нужно встраивать в ядро - он может быть отдельным модулем, который проверяет промахи кэша и если их много, то он пытается понять паттерн запросов к памяти и предварительно загружать те данные из ОЗУ, которые соответствуют паттерну. Может очень значительно повышать эффективность работы процессора. В общем случае, половина кэша - это мусор, который процессору не потребуется, т.к. распознать паттерн крайне сложно. В Эльбрусе шестого поколения есть возможность программно указать паттерн, что может значительно повысить эффективность использования кэша
- Предсказание ветвлений не для всех алгоритмов работает хорошо. Основная проблема возникает в том случае, если процессор начинает сильно ошибаться в предсказаниях. При ошибке предсказания приходится сбрасывать конвейер, который может быть очень длинным. Примером не дружелюбного к предсказаниям алгоритма является "пузырьковая сортировка", в которой предсказания будут носить около случайный характер. Предсказание сортировки даёт десятки процентов повышения производительности процессора. Существуют альтернативные решения. В частности, в шестом поколении Эльбрусов использовался "станок ветвления", в котором вычисления могли вестись по двум ветвям и когда одна из веток признаётся "ошибочной" происходит переключение на другую ветку за один такт процессора. В той же "пузырьковой сортировке" Эльбрус рвёт всех конкурентов в хлам. **Out of Order** очень жадный механизм - он тратит очень много энергии на свою работу и это одна из причин, по которой P-ядра расходуют кратно больше энергии, чем E-ядра

## Оценка процессоров в 2024 году

В названии процессоров очень много маркетинга. Можно было бы предположить, что седьмое поколение AMD Ryzen содержит более производительные ядра, чем пятое поколение, но в действительности, первая цифра в названии Ryzen - просто год выпуска процессора. Для примера, возьмём [характеристики разных процессоров](https://amd.news/obzor/amd-mobile/) "седьмого поколения":

- Ryzen7 7840H: Phoenix, Zen4 4nm
- Ryzen7 7745HX: Dragon Range, Zen4 5nm
- Ryzen7 7736U: Rembrandt, Zen3+ 6nm
- Ryzen7 7730U: Barcelo, Zen3 6nm
- Ryzen5 7520U: Mendocino, Zen2 6nm
- Ryzen3 7440U: Phoenix2, Zen4 4nm

Как видно из приведённого выше списка, в седьмом поколении процессоров используется четыре разных архитектуры с огромным разбросом производительности. Причём, перемешено всё очень сильно - 7440U базируется на архитектуре Zen4, тогда как 7520U на Zen2.

Однако, если посмотреть на широко представленные в 2024 году ноутбуки на "пятом поколении" процессоров AMD, то там ситуация тоже довольно запутанная:

- Ryzen7 5825U: Barcelo Zen3, 7nm
- Ryzen7 5800U: Cezanne Zen3, 7nm
- Ryzen5 5500U: Lucienne Zen2, 7nm

Т.е. в разных поколениях могут использоваться одинаковые архитектуры процессоров, но новые поколения содержат оптимизации архитектуры, как минимум - улучшенный техпроцесс. За счёт этого чуть подтянут Boost (~200 МГц) и базовая частота ядер (~100 МГц). Для шести ядер, дополнительные 600 МГц могут дать дополнительные 3-7% в производительности, при том же самом техпроцессе.

В прессе много сообщений о большом количестве брака в старших моделях Intel 13-го и 14-го поколений. Очень часто встречаются проблемы с Core i9, но проблема также затрагивает Core i7 в редакции X. Обсуждается две вероятных причины - Over-volting (микрокод 129 решает проблему) и окисление с физическим разрушением процессора. Обе проблемы, потенциально, способны полностью разрушить процессор без возможности дальнейшего восстановления.

## Почему отключение ядер может привести к повышению производительности системы

Отключать ядра можно в BIOS/UEFI и это может оказать позитивный эффект на систему по двум причинам:

- отключение слабых ядер приводит к устранению ошибок планировщика, который будет все задачи отдавать производительным ядрам
- отлючение трети ядер может приводить к снижению нагрева и эффективному использованию Boost-а на оставшихся ядрах

Это особенно важно для ноутбуков.

## Особенности производства современных процессоров (2024)

В 2024 году, см. статью Jared Walton на странице 11, журнала "Maximum PC", август 2024: пропроектировании процессоров Intel стали использоваться современные системы проектирования в которых есть функционал портирования схемы под разные производства. В частности, можно генерировать документацию для производства как на заводах Intel, так и на заводах TSMC. Процессоры на базе архитектуры Lunar Lake состоят из "плитки" процессорных блоков, выпускаемых с разными техпроцессами. В частности, подсистема ввода/вывода (I/O) производится по техпроцессу TSMC's N6, а CPU - по TSMC's N3B. Важно заметить, что модули I/O плохо масштабируются под самые современные техпроцессы и им вполне достаточно 6-10 нм.

Современные процессоры - гибридные. Причён Intel использует разные ядра (P и E), тогда как AMD использует одинаковые ядра, но с разным размером кэша и работающие на разной максимальной тактовой частоте.

Мобильные процессоры Intel Lunar Lake содержат до 8 ядер, а AMD Strix Point - до 12 CPU, что делает процессоры AMD наиболее производительными.
